{% extends 'base_reservas.html' %}
{% load static %}

{% block title %}Crear Nuevo Usuario{% endblock %}

{% block content_2 %}
<div class="form-box" style="max-width: 800px; margin: auto;">
    <h2>Crear Nuevo Usuario</h2>
    <p>Rellene los siguientes campos para registrar un nuevo usuario en el sistema.</p>


    <form action="{% url 'crear_usuario' %}" method="post" class="admin-create-form">
        {% csrf_token %}

        <!-- Cedula -->
        <div class="admin-create-form__group">
            <label for="cedula" class="admin-create-form__label">Cédula:</label>
            <input type="number" id="cedula" name="cedula" placeholder="Ej: 123456789" required class="admin-create-form__input">
        </div>

        <!-- Nombre Completo -->
        <div class="admin-create-form__group">
            <label for="nombre" class="admin-create-form__label">Nombre Completo:</label>
            <input type="text" id="nombre" name="nombre" placeholder="Ej: Juan Pérez" required class="admin-create-form__input">
        </div>

        <!-- Correo Electronico -->
        <div class="admin-create-form__group">
            <label for="correo" class="admin-create-form__label">Correo Electrónico:</label>
            <input type="email" id="correo" name="correo" placeholder="ejemplo@correo.com" required class="admin-create-form__input">
        </div>

        <!-- Celular -->
        <div class="admin-create-form__group">
            <label for="celular" class="admin-create-form__label">Celular:</label>
            <input type="tel" id="celular" name="celular" placeholder="Ej: 3001234567" required class="admin-create-form__input">
        </div>
        
        <!-- Fecha de Nacimiento -->
        <div class="admin-create-form__group">
            <label for="fecha_nacimiento" class="admin-create-form__label">Fecha de Nacimiento:</label>
            <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required class="admin-create-form__input">
        </div>

        <!-- Contraseña -->
        <div class="admin-create-form__group">
            <label for="contrasena" class="admin-create-form__label">Contraseña:</label>
            <input type="password" id="contrasena" name="contrasena" required class="admin-create-form__input">
        </div>

        <!-- Rol -->
        {# Aplicamos la clase de grupo y el modificador de ancho completo, valida tambien para apartamento#}
        <div class="admin-create-form__group admin-create-form__group--full-width">
            <label for="rol" class="admin-create-form__label">Rol del Usuario:</label>
            <select id="rol" name="rol" required class="admin-create-form__input">
                <option value="" disabled selected>-- Seleccione un rol --</option>
                <option value="Admin">Administrador</option>
                <option value="Propietario">Propietario</option>
                <option value="Residente">Residente</option>
            </select>
        </div>

        <!-- Apartamento -->
        <div class="admin-create-form__group admin-create-form__group--full-width" id="apartment-field-container" style="display: none;">
            <label for="apartamento" class="admin-create-form__label">Asociar a Apartamento:</label>
            <select id="apartamento" name="apartamento" class="admin-create-form__input">
                <option value="">-- Seleccione un apartamento --</option>
                {# Usamos la nueva variable 'apartamentos' que pasamos desde la vista #}
                {% for apto in apartamentos %}
                    <option value="{{ apto.pk }}">Torre {{ apto.torre }} - Apto {{ apto.numero }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Botón de Envío -->
        <div class="admin-create-form__actions">
            <button type="submit" class="btn-confirm">Crear Usuario</button>
        </div>

    </form>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    // Espera a que todo el contenido de la página se haya cargado
    document.addEventListener('DOMContentLoaded', function() {

        const rolSelect = document.getElementById('rol');
        const apartmentContainer = document.getElementById('apartment-field-container');
        const apartmentSelect = document.getElementById('apartamento');


        function toggleApartmentField() {
            const selectedRole = rolSelect.value;

            if (selectedRole === 'Propietario' || selectedRole === 'Residente') {

                apartmentContainer.style.display = 'block'; // Mostramos el contenedor
                apartmentSelect.required = true;
            } else {
                apartmentContainer.style.display = 'none'; // Ocultamos el contenedor
                apartmentSelect.required = false; 
                apartmentSelect.value = '';
            }
        }

        rolSelect.addEventListener('change', toggleApartmentField);

        toggleApartmentField();
    });
</script>
{% endblock %}