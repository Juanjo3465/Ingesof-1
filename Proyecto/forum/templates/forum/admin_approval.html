<!-- admin_approval.html -->
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Approval - Foro de la Comunidad</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'forum/admin_styles.css' %}">
   
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1 class="admin-title">
                <span class="material-icons">admin_panel_settings</span>
                Panel de Aprobación de Publicaciones
            </h1>
            <div class="admin-controls">
                <select class="filter-select" id="categoryFilter">
                    <option value="all">Todas las categorías</option>
                    <option value="general">General</option>
                    <option value="events">Eventos</option>
                    <option value="announcements">Anuncios</option>
                </select>
                <input type="text" class="search-box" id="searchPosts" placeholder="Buscar publicaciones...">
                <button class="refresh-button" id="refreshButton">
                    <span class="material-icons">refresh</span>
                    Actualizar
                </button>
            </div>
        </div>
{% comment %} 
        <div class="admin-stats">
            <div class="stat-card">
                <div class="stat-number stat-pending" id="pendingCount">5</div>
                <div class="stat-label">Pendientes de Aprobación</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-approved" id="approvedCount">12</div>
                <div class="stat-label">Aprobadas Hoy</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-rejected" id="rejectedCount">3</div>
                <div class="stat-label">Rechazadas Hoy</div>
            </div>
        </div>

        <div class="batch-actions">
            <div class="batch-select">
                <input type="checkbox" id="selectAll">
                <label for="selectAll">Seleccionar todos</label>
            </div>
            <button class="btn btn-approve" id="batchApprove">
                <span class="material-icons">check_circle</span>
                Aprobar Seleccionados
            </button>
            <button class="btn btn-reject" id="batchReject">
                <span class="material-icons">cancel</span>
                Rechazar Seleccionados
            </button>
        </div> {% endcomment %}

        <div class="posts-scroll-window" id="pendingPostsContainer">
            <!-- Pending Post 1 -->
            <div class="pending-post-card" data-post-id="1">
                <span class="post-status-badge status-pending">Pendiente</span>
                <div class="post-header">
                    <div class="user-avatar">JP</div>
                    <div class="post-user-info">
                        <div class="username">Juan Perez</div>
                        <div class="post-meta">
                            <span>Enviado: Hace 2 horas</span>
                            <span>Categoría: General</span>
                        </div>
                    </div>
                </div>
                <h3 class="post-title">Mantenimiento del estacionamiento este fin de semana</h3>
                <p class="post-content">Lorem ipsum dolor sit amet consectetur adipisicing elit. Quae repellat provident voluptatum velit laudantium similique doorbius quia perferendis debitis, architecto eligendi detectus...</p>
                <div class="post-image-preview">
                    <span>Vista previa de imagen</span>
                </div>
                <div class="admin-actions">
                    <button class="btn btn-preview">
                        <span class="material-icons">visibility</span>
                        Vista Previa
                    </button>
                    <button class="btn btn-approve approve-btn">
                        <span class="material-icons">check_circle</span>
                        Aprobar
                    </button>
                    <button class="btn btn-reject reject-btn">
                        <span class="material-icons">cancel</span>
                        Rechazar
                    </button>
                </div>
            </div>

            <!-- Pending Post 2 -->
            <div class="pending-post-card" data-post-id="2">
                <span class="post-status-badge status-pending">Pendiente</span>
                <div class="post-header">
                    <div class="user-avatar">ML</div>
                    <div class="post-user-info">
                        <div class="username">Maria Lopez</div>
                        <div class="post-meta">
                            <span>Enviado: Hace 5 horas</span>
                            <span>Categoría: Eventos</span>
                        </div>
                    </div>
                </div>
                <h3 class="post-title">Fiesta de bienvenida para nuevos residentes</h3>
                <p class="post-content">Estamos organizando una fiesta de bienvenida para todos los nuevos residentes del edificio. Será este sábado en la sala común a las 7 PM. Por favor confirmen su asistencia...</p>
                <div class="admin-actions">
                    <button class="btn btn-preview">
                        <span class="material-icons">visibility</span>
                        Vista Previa
                    </button>
                    <button class="btn btn-approve approve-btn">
                        <span class="material-icons">check_circle</span>
                        Aprobar
                    </button>
                    <button class="btn btn-reject reject-btn">
                        <span class="material-icons">cancel</span>
                        Rechazar
                    </button>
                </div>
            </div>

            <!-- Pending Post 3 -->
            <div class="pending-post-card" data-post-id="3">
                <span class="post-status-badge status-pending">Pendiente</span>
                <div class="post-header">
                    <div class="user-avatar">CR</div>
                    <div class="post-user-info">
                        <div class="username">Carlos Rodriguez</div>
                        <div class="post-meta">
                            <span>Enviado: Hace 1 día</span>
                            <span>Categoría: Anuncios</span>
                        </div>
                    </div>
                </div>
                <h3 class="post-title">Problemas con el sistema de calefacción</h3>
                <p class="post-content">He notado que el sistema de calefacción en el pasillo del tercer piso no está funcionando correctamente. Las temperaturas han sido inconsistentes durante los últimos días...</p>
                <div class="post-image-preview">
                    <span>Imagen técnica adjunta</span>
                </div>
                <div class="admin-actions">
                    <button class="btn btn-preview">
                        <span class="material-icons">visibility</span>
                        Vista Previa
                    </button>
                    <button class="btn btn-approve approve-btn">
                        <span class="material-icons">check_circle</span>
                        Aprobar
                    </button>
                    <button class="btn btn-reject reject-btn">
                        <span class="material-icons">cancel</span>
                        Rechazar
                    </button>
                </div>
            </div>

            {% for post in pending_posts %}
            <div class="pending-post-card" data-post-id="{{ post.id_publicacion }}">
                <span class="post-status-badge status-pending">Pendiente</span>
                <div class="post-header">
                    <div class="user-avatar">{{ post.id_usuario.nombre|slice:":2"|upper }}</div>
                    <div class="post-user-info">
                        <div class="username">{{ post.id_usuario.nombre }}</div>
                        <div class="post-meta">
                            <span>Enviado: {{ post.fecha_publicacion }}</span>
                            <span>Categoría: {{ post.categoria }}</span>
                        </div>
                    </div>
                </div>
                <h3 class="post-title">{{ post.titulo }}</h3>
                <p class="post-content">{{ post.descripcion }}</p>
                {% if post.imagen %}
                <div class="post-image-preview">
                    <img src="{{ post.imagen.url }}" alt="Imagen del post">
                </div>
                {% endif %}
                <div class="admin-actions">
                    <button class="btn btn-preview">
                        <span class="material-icons">visibility</span>
                        Vista Previa
                    </button>
                    <a href="{% url 'accept_post' post.id_publicacion %}">
                        <button class="btn btn-approve approve-btn">
                            <span class="material-icons">check_circle</span>
                            Aprobar
                        </button>
                    </a>
                    <a href="{% url 'reject_post' post.id_publicacion %}">
                        <button class="btn btn-reject reject-btn">
                            <span class="material-icons">cancel</span>
                            Rechazar
                        </button>
                    </a>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <span class="material-icons">assignment_turned_in</span>
                <h3>No hay publicaciones pendientes</h3>
                <p>Todas las solicitudes han sido revisadas.</p>
            </div>
            {% endfor %}
        </div>

        {% comment %} <button class="back-button" onclick="window.location.href='/admin/'">
            <span class="material-icons">arrow_back</span>
            Volver al Panel Principal
        </button> {% endcomment %}
    </div>

    <script>
        // Approve post functionality
        {% comment %} document.querySelectorAll('.approve-btn').forEach(button => {
            button.addEventListener('click', function() {
                const postCard = this.closest('.pending-post-card');
                const postId = postCard.dataset.postId;
                const userName = postCard.querySelector('.username').textContent;
                const postTitle = postCard.querySelector('.post-title').textContent;
                
                if (confirm(`¿Estás seguro de que quieres aprobar la publicación "${postTitle}" de ${userName}?`)) {
                    // In a real application, you would send an AJAX request to the server
                    postCard.style.opacity = '0.5';
                    postCard.style.pointerEvents = 'none';
                    
                    // Simulate API call
                    setTimeout(() => {
                        postCard.remove();
                        updateStats();
                        showNotification('Publicación aprobada exitosamente', 'success');
                    }, 1000);
                }
            });
        });

        // Reject post functionality
        document.querySelectorAll('.reject-btn').forEach(button => {
            button.addEventListener('click', function() {
                const postCard = this.closest('.pending-post-card');
                const postId = postCard.dataset.postId;
                const userName = postCard.querySelector('.username').textContent;
                const postTitle = postCard.querySelector('.post-title').textContent;
                
                const reason = prompt(`¿Por qué quieres rechazar la publicación "${postTitle}" de ${userName}?`);
                
                if (reason !== null) {
                    // In a real application, you would send an AJAX request to the server
                    postCard.style.opacity = '0.5';
                    postCard.style.pointerEvents = 'none';
                    
                    // Simulate API call
                    setTimeout(() => {
                        postCard.remove();
                        updateStats();
                        showNotification('Publicación rechazada exitosamente', 'error');
                    }, 1000);
                }
            });
        });

        // Batch actions
        const selectAll = document.getElementById('selectAll');
        const batchApprove = document.getElementById('batchApprove');
        const batchReject = document.getElementById('batchReject');

        selectAll.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.pending-post-card input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });

        batchApprove.addEventListener('click', function() {
            const selectedPosts = document.querySelectorAll('.pending-post-card input[type="checkbox"]:checked');
            if (selectedPosts.length === 0) {
                alert('Por favor selecciona al menos una publicación para aprobar.');
                return;
            }
            
            if (confirm(`¿Estás seguro de que quieres aprobar ${selectedPosts.length} publicación(es)?`)) {
                selectedPosts.forEach(checkbox => {
                    const postCard = checkbox.closest('.pending-post-card');
                    postCard.style.opacity = '0.5';
                    postCard.style.pointerEvents = 'none';
                    
                    setTimeout(() => {
                        postCard.remove();
                        updateStats();
                    }, 500);
                });
                showNotification(`${selectedPosts.length} publicación(es) aprobada(s) exitosamente`, 'success');
            }
        });

        batchReject.addEventListener('click', function() {
            const selectedPosts = document.querySelectorAll('.pending-post-card input[type="checkbox"]:checked');
            if (selectedPosts.length === 0) {
                alert('Por favor selecciona al menos una publicación para rechazar.');
                return;
            }
            
            const reason = prompt(`¿Por qué quieres rechazar ${selectedPosts.length} publicación(es)?`);
            if (reason !== null) {
                selectedPosts.forEach(checkbox => {
                    const postCard = checkbox.closest('.pending-post-card');
                    postCard.style.opacity = '0.5';
                    postCard.style.pointerEvents = 'none';
                    
                    setTimeout(() => {
                        postCard.remove();
                        updateStats();
                    }, 500);
                });
                showNotification(`${selectedPosts.length} publicación(es) rechazada(s) exitosamente`, 'error');
            }
        }); {% endcomment %}

        // Update statistics
        function updateStats() {
            const pendingPosts = document.querySelectorAll('.pending-post-card').length;
            document.getElementById('pendingCount').textContent = pendingPosts;
            
            // In a real app, you would fetch these from the server
            const approvedCount = parseInt(document.getElementById('approvedCount').textContent) + 1;
            document.getElementById('approvedCount').textContent = approvedCount;
        }

        // Search functionality
        document.getElementById('searchPosts').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const posts = document.querySelectorAll('.pending-post-card');
            
            posts.forEach(post => {
                const title = post.querySelector('.post-title').textContent.toLowerCase();
                const content = post.querySelector('.post-content').textContent.toLowerCase();
                const username = post.querySelector('.username').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || content.includes(searchTerm) || username.includes(searchTerm)) {
                    post.style.display = 'block';
                } else {
                    post.style.display = 'none';
                }
            });
        });

        // Refresh functionality
        document.getElementById('refreshButton').addEventListener('click', function() {
            this.classList.add('rotating');
            // In a real app, you would fetch new data from the server
            setTimeout(() => {
                this.classList.remove('rotating');
                showNotification('Datos actualizados', 'info');
            }, 1000);
        });

        // Notification system
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            
            if (type === 'success') {
                notification.style.backgroundColor = '#28a745';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#dc3545';
            } else {
                notification.style.backgroundColor = '#17a2b8';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Add checkboxes to posts for batch operations
        document.querySelectorAll('.pending-post-card').forEach(post => {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.style.cssText = `
                position: absolute;
                top: 20px;
                left: 20px;
                width: 18px;
                height: 18px;
            `;
            post.style.position = 'relative';
            post.appendChild(checkbox);
        });
    </script>
</body>
</html>